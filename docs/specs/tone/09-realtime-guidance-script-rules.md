# Real-time Guidance Script Rules

**类型**: Tone  
**版本**: v1.0  
**状态**: 🟡 进行中  
**最后更新**: 2026-02-05

---

## Changelog

### v1.0 - 2026-02-05
- ✅ 接收完整话术规格文档
- 定义「意象指令 + 感受验证」的双核结构
- 定义问题与话术的映射表（膝盖、腰部、骨盆、躯干）
- 定义冷却重复提示逻辑（完整 vs 关键词）
- 定义优先级选择与语气原则（动词、意象、简短、正面）

---

## Implementation Log

### 理解要点

1. **结构化指令**:
   - 核心是「意象指令」(想象.../像...)，这比纯物理解释（如：请外旋髋关节）对普通用户更直观。
   - 辅助「感受验证」(确认身体感觉)，形成闭环。

2. **状态感知话术**:
   - `is_first_trigger`: 决定了播报的详略程度。这对用户体验至关重要，避免在运动中听到重复的长句子。

3. **语气与长度控制**:
   - 动词驱动，正面导向（不说“别”，说“要”）。
   - 字数限制严格：首次 <10字，重复 <5字。这对 TTS 的处理和用户在高强度运动下的认知负荷非常重要。

### 实现计划

1. **话术映射库**:
   - 在 `src/constants/guidance-scripts.ts` 中建立映射表。
2. **话术生成器**:
   - `GuidanceScriptService`: 根据算法输出的 `issue` 和 `is_first_trigger` 状态动态生成文本。
3. **播放控制**:
   - 与 F4 (Real-time Guidance Flow) 的播报引擎配合，处理打断和优先级。

### 待澄清问题

- 话术库是否需要根据性别（男/女）或运动强度进行语气微调？（当前规格未特殊指明，暂按统一回复实现）

---

## 规格内容

# 实时引导话术规则

## 输入

算法实时输出：问题类型 + 当前帧数值

## 输出

语音播报文本（简短、可操作）

## 规则模板

### 结构

{意象指令} + {感受验证}

---

## 示例映射表

| 问题 | 意象指令 | 感受验证 |
| --- | --- | --- |
| 膝盖内扣 | 「膝盖往外推，像要把地面撑开」 | 「感受大腿外侧发力」 |
| 腰部拱起 | 「收紧核心，肚脐往脊柱贴」 | 「夹紧臀部，像夹纸」 |
| 骨盆晃动 | 「骨盆保持水平，别晃」 | 「重心在脚中心」 |
| 躯干前倾 | 「躯干挺直，想象头顶被拉起」 | 「感受脊柱拉长」 |

---

## 冷却重复提示

- 首次：完整指令
- 重复：关键词，如「膝盖外推」

---

## 完整示例

**算法输入**（首次触发）：

```json
{"name": "knee_valgus", "frame_id": 145, "is_first_trigger": true}
```

**话术输出**：

「膝盖往外推，像要把地面撑开」

**算法输入**（5秒后重复）：

```json
{"name": "knee_valgus", "frame_id": 295, "is_first_trigger": false}
```

**话术输出**：

「膝盖外推」

---

## 优先级话术选择

当检测到多个问题时：

1. 仅播报最高优先级问题
2. 出现新的更高优先级，打断当前播报

---

## 语气原则

- 用动词：推、夹、收紧
- 造意象：「像...」的比喻
- 保持简短：首次提示 <10字，重复 <5字
- 避免否定：说「往外推」不说「别往里扣」

---

[返回主文档](../../README.md) | [查看实现跟踪](../../implementation-tracking.md)
