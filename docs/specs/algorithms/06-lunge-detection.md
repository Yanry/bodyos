# Lunge Detection Algorithm

**类型**: Algorithm  
**版本**: v1.0  
**状态**: 🟡 进行中  
**最后更新**: 2026-02-05

---

## Changelog

### v1.0 - 2026-02-05
- ✅ 接收完整算法规格文档
- 定义四大检测项：膝盖对齐、躯干前倾、发力分配、骨盆对齐
- 定义具体计算逻辑（基于 MediaPipe 关键点投影与夹角）
- 定义分级阈值与扣分规则
- 定义输出格式

---

## Implementation Log

### 理解要点

1. **多检测项权重**:
   - **膝盖对齐 (35%)**: 侧面视角膝-踝垂直投影，核心是防止前膝过脚尖。
   - **躯干前倾 (30%)**: 肩-髋中线与垂直线夹角。
   - **发力分配 (25%)**: 较为主观的物理量，需通过髋下沉深度和膝屈曲角度估算。
   - **骨盆对齐 (10%)**: 唯一涉及**正面视角**的项，需注意用户可能需要调整机位或在动作中通过投影估算。

2. **计算挑战**:
   - **膝盖对齐**: 需要相对脚尖的水平偏移量。脚尖（29/31/32）坐标的稳定性至关重要。
   - **发力分配**: 规格定义为前/后腿百分比。实现上需建立一个从 `(hip_depth, knee_angles)` 到比例的经验映射模型。

3. **坐标系切换**:
   - 前三项依赖侧面视角，第四项明确提到正面视角。在 MVP 阶段需告知用户最佳角度（侧面为主，兼顾骨盆投影计算）。

### 实现计划

1. **膝盖算法**: 实现基于像素/比例的水平偏移计算，并映射到 cm（需人体高度作为比例尺）。
2. **权重引擎**: 实现多维评分累加逻辑，包含下限保护。
3. **状态判定**: 识别动作的「最低点」作为静态分析帧。

### 待澄清问题

- **正面视角与侧面视角切换**: 用户是一次录制（侧面）还是两次录制？规格中 1-3 项在侧面，第 4 项提到了正面视角。暂按侧面视角下的投影对齐计算。

---

## 规格内容

# 算法规格

## 输入

- 视频帧序列（MediaPipe Pose 关键点）
- 帧率：30fps
- 分析时长：动作阶段 3-5个
- **拍摄角度**：侧面 90°

## 检测项与计算方法

### 1. 膝盖对齐（前腿）

**计算**：

- 侧面视角，膝（25）- 踝（27）垂直投影距离
- 测量膝盖水平偏移量

**阈值**：

| 级别 | 膝盖位置 |
| --- | --- |
| 正常 | 在脚尖后方（绿） |
| 轻度 | 超脚尖 0-3cm（黄） |
| 严重 | 超脚尖 >3cm（红） |

**权重**：35%

**扣分**：轻度 -10分，严重 -26分

---

### 2. 躯干前倾

**计算**：

- 侧面视角，躯干中线（肩-髋）与垂直线夹角

**阈值**：

| 级别 | 躯干角度 |
| --- | --- |
| 正常 | <15°（绿） |
| 轻度 | 15-30°（黄） |
| 严重 | >30°（红） |

**权重**：30%

**扣分**：轻度 -9分，严重 -22分

---

### 3. 前后腿发力分配

**计算**：

- 基于髋下沉深度和膝屈曲角度
- 前腿：60-70% 理想
- 后腿：30-40% 理想

**阈值**：

| 级别 | 前腿发力 |
| --- | --- |
| 正常 | 60-70%（绿） |
| 轻度 | 50-60% 或 70-80%（黄） |
| 严重 | <50% 或 >80%（红） |

**权重**：25%

**扣分**：轻度 -7分，严重 -18分

---

### 4. 骨盆对齐

**计算**：

- 侧面/正面投影视角，左/右髋水平对齐
- 骨盆旋转角度

**阈值**：

| 级别 | 旋转 | 高度差 |
| --- | --- | --- |
| 正常 | <5° | <0.03 肩宽 |
| 轻度 | 5-12° | 0.03-0.08 |
| 严重 | >12° | >0.08 |

**权重**：10%

**扣分**：轻度 -3分，严重 -8分

## 评分公式

总分 = max(15, 100 - Σ(扣分))

**下限保护**：最低 15 分，避免过度挫败感

## 输出格式

（与靠墙静蹲算法相同结构）

---

[返回主文档](../../README.md) | [查看实现跟踪](../../implementation-tracking.md)
