# Camera Preparation Flow

**类型**: Feature  
**版本**: v1.0  
**状态**: 待实现  
**最后更新**: 2026-02-05

---

## Changelog

### v1.0 - 2026-02-05
- ✅ 接收完整功能规格文档
- 定义拍摄须知流程（动作选择 -> 须知弹窗 -> 相机页）
- 定义拍摄须知具体内容（着装、环境、距离、角度、摄像头）
- 定义引导 UI 与倒计时逻辑
- 定义边界情况处理（相机权限）

---

## Implementation Log

### 理解要点

1. **业务流程**:
   - 动作选择后进入引导流程。
   - 必须通过「拍摄须知」这一关卡，确保用户了解如何正确放置设备和穿着。
   - 相机页具有高度的实时交互性，通过红/绿框反馈关键点捕获情况。

2. **核心逻辑**:
   - **入框检测**: 监控肩-髋-膝-踝关键点。核心是髋和膝必须完整。
   - **倒计时触发**: 满足关键点条件且保持 > 2秒。
   - **权限管理**: 拦截式提示，并引导至系统设置。

3. **UI 组件需求**:
   - 拍摄须知弹窗/底部抽屉。
   - 实时引导框（颜色驱动：白色/红色/绿色）。
   - 倒计时动画/语音。
   - 相机内帮助入口。

### 实现计划

1. **组件开发**:
   - `ShootingInstructions`: 拍摄须知展示组件，支持抽屉和弹窗模式。
   - `CameraOverlay`: 渲染引导框、引导文字和倒计时。
   - `CameraPreparationContainer`: 封装整个准备流程的状态机（基于 Global Spec）。

2. **逻辑集成**:
   - 集成 MediaPipe Pose 检测，实现 `isReadyForRecording` 的布尔逻辑。
   - 权限检查 Hook (`useCameraPermission`)。

### 待澄清问题

- 录制时长进度条的具体时长是由各个动作规格定义的吗？(根据 Global Spec 应由 Motion Module 定义)

---

## 规格内容

# Feature Overview

动作检测前的相机准备和拍摄引导流程。

## Flow

1. 动作选择 → 点击「开始检测」
2. 弹出「拍摄须知」（弹窗/底部抽屉）
3. 用户阅读 → 进入相机页
4. （前置/后置摄像头切换按钮）
5. 实时入框引导（绿/红框）
6. 倒计时触发 → 开始录制
7. 录制完成 → 跳转分析页

## 拍摄须知内容

### 着装要求

- 紧身或修身运动服（便于识别关键点）
- 避免宽松衣物遮挡关节
- 推荐：运动背心/紧身裤

### 环境要求

- 光线充足，避免逆光
- 背景简洁，无复杂图案
- 地面平整（靠墙静蹲需要墙面）

### 距离要求

- 最小距离：0.8m
- 推荐：手机放置在腰部高度

### 拍摄角度（不同动作只显示相应的提示）

- **靠墙静蹲**：手机放在身体正侧方 90°，拍摄侧面
- **弓步蹲**：手机放在身体正侧方 90°，拍摄侧面
- 确保肩-髋-膝-踝在同一平面内清晰可见

### 摄像头选择

- 前置：能看到屏幕引导，但视野窄
- 后置：视野广，需提前调整位置

## 引导 UI

### 入框检测

- 关键点检测：肩-髋-膝-踝
- 必须完整：髋、膝（头和脚可以裁切）
- 实时反馈：绿框 = 可以，红框 = 调整
- 角度提示：「请从侧面拍摄，看到完整轮廓」

### 倒计时

- 触发条件：关键点完整 > 2秒
- 倒计时：「3、2、1，开始」

## 相机内轻量入口

- 右上角「?」图标按钮
- 点击弹出底部抽屉（相同拍摄须知）
- 用户随时可查看

## UI Elements

- 拍摄须知按钮
- 摄像头切换按钮
- 引导框（颜色状态）默认白色，有问题红色，ok绿色
- 倒计时数字
- 录制时长进度条
- 重拍按钮

## 边界情况

### 相机权限拒绝

- 触发时机：用户点击「开始检测」进入相机页
- 处理：弹窗提示「需要相机权限才能检测动作」+ 「去设置」按钮
- 点击「去设置」跳转系统设置页
- 返回 App 后重新检查权限状态

---

[返回主文档](../../README.md) | [查看实现跟踪](../../implementation-tracking.md)
